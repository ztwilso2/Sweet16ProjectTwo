<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>MentorMe</title>
    <link rel="stylesheet" type="text/css" href="StyleSheet1.css">
    
</head>

<body>
    <header>
        <div class="header">
            <h1>MentorMe</h1>
            <p>Mentoring for Professionals Everywhere</p>
            <nav>
                <ul>
                    <li onclick="LogOff()"><a href="">Logout</a></li>
                    <li><a href="homepage.html">Home</a></li>
                    <li><a href="profile.html">Profile</a></li>
                    <li></li>
                </ul>
            </nav>
        </div>
    </header>

    <section id="mentorLayout">
        <div class="currentMentees">
            THESE ARE CURRENT MENTEES
        </div>

        <div class="menteeRequests">
            ACCEPT OR DECLINE MENTEES HERE
        </div>
        
    </section>

    <section id="bothLayout">
        <div class="mentorSideDiv">
            <div class="currentMentees">
                THESE ARE CURRENT MENTEES
            </div>

            <div class="menteeRequests">
                ACCEPT OR DECLINE MENTEES HERE
            </div>
        </div>
        <div class="menteeSideDiv">
            <div class="mentorsDiv">
                <h2>Available Mentors</h2>

                <form class="mentorFilter">
                    <select id="bothJobTitleFilter">
                        <option value="default">--</option>
                    </select>
                    <select id="bothExpertiseFilter">
                        <option value="default">--</option>
                    </select>
                    <button type="button" onclick="loadFilteredMentors()">Filter</button>
                </form>

                <div class="mentorList">

                </div>
            </div>
        </div>
    </section>

    <section id="menteeLayout">
        <div class="menteeProfileDiv">
            
        </div>
        <div class="mentorsDiv">
            <h2>Available Mentors</h2>

            <form class="mentorFilter">
                <select id="menteeJobTitleFilter">
                    <option value="default">--</option>
                </select>
                <select id="menteeExpertiseFilter">
                    <option value="default">--</option>
                </select>
                <button type="button" onclick="loadFilteredMentors()">Filter</button>
            </form>

            <div class="mentorList">

            </div>
        </div>   
                
    </section>

    <footer>
        <p>Made By: Sweet 16</p>
        <p>Brittney Ginther, Janelle Halter, Ben Mack, Alexis Ross, Zack Wilson</p>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript">

              
        document.addEventListener("load", loadPage());


        function loadPage() {
            sessionType = localStorage.getItem("sessionType");

            if (sessionType == "mentee") {
                loadMenteePage();
            }
            else if (sessionType == "mentorMentee") {
                loadMentorMenteePage();
            }
            else if (sessionType == "mentor") {
                loadMentorPage();
            }
        }

        function loadMenteePage() {
            $("#menteeLayout").css("display", "block");
            $("#bothLayout").css("display", "none");
            $("#mentorLayout").css("display", "none");
            loadMentors();
            loadFilters();
        }

        function loadMentorMenteePage() {
            $("#menteeLayout").css("display", "none");
            $("#bothLayout").css("display", "block");
            $("#mentorLayout").css("display", "none");
            loadMentors();
            loadFilters();
        }

        function loadMentorPage() {
            $("#menteeLayout").css("display", "none");
            $("#bothLayout").css("display", "none");
            $("#mentorLayout").css("display", "block");
        }

        function loadFilters() {
            var webMethod = "ProjectServices.asmx/LoadFilters";
            var uid = localStorage.getItem("sessionId");
            var parameters = "{\"sessionId\":\"" + encodeURI(uid) + "\"}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {

                    if (msg.d.length > 0) {

                        filtersArray = msg.d;

                        var jobTitleArray = []
                        var expertiseArray = []


                        for (var i = 0; i < filtersArray.length; i++) {

                            jobTitleArray.push(filtersArray[i].jobTitle);
                            expertiseArray.push(filtersArray[i].expertise);
                        }

                        
                        var uniquejobTitleArray = [];
                        $.each(jobTitleArray, function (i, el) {
                            if ($.inArray(el, uniquejobTitleArray) === -1) uniquejobTitleArray.push(el);
                        });

                        var uniqueExpertiseArray = [];
                        $.each(expertiseArray, function (i, el) {
                            if ($.inArray(el, uniqueExpertiseArray) === -1) uniqueExpertiseArray.push(el);
                        });

                        for (var i = 0; i < uniquejobTitleArray.length; i++) {


                            var jobTitle = "<option value='" + uniquejobTitleArray[i] + "'>" + uniquejobTitleArray[i] + "</option>";

                            $("#bothJobTitleFilter").append(jobTitle);
                            $("#menteeJobTitleFilter").append(jobTitle);
                        }

                        for (var i = 0; i < uniqueExpertiseArray.length; i++) {

                            var expertise = "<option value='" + uniqueExpertiseArray[i] + "'>" + uniqueExpertiseArray[i] + "</option>";

                            $("#bothExpertiseFilter").append(expertise);
                            $("#menteeExpertiseFilter").append(expertise);

                        }

                    }
  

                },
                error: function (e) {
                    alert("Can't load filters." + e);
                }
            });
        }
        


        function goToLogOn() {
            window.location.assign("./loginPage.html")
        }



        //function currentDate() {
        //   var today = new Date();
        //    var day = today.getDate()
        //    var month = today.getMonth() + 1
        //    var year = today.getFullYear()

        //    month = (month < 10 ? "0" : "") + month;
        //    day = (day < 10 ? "0" : "") + day;

        //    var date = year + "-" + month + "-" + day

        //    document.getElementById('newDate').value = date;
        //}

        //var rsvpCount;
        //function RSVP(eventId) {
        //    var webMethod = "ProjectServices.asmx/GetRSVPCount";
        //    var parameters = "{\"eventId\":\"" + encodeURI(eventId) + "\"}";
            
        //    $.ajax({
        //        async: false,
        //        type: "POST",
        //        url: webMethod,
        //        data: parameters,
        //        contentType: "application/json; charset=utf-8",
        //        dataType: "json",
        //        success: function (msg) {
        //            if (msg.d) {
                        
        //                rsvpCount = Number(msg.d[0].rsvpCount);
        //                rsvpCount++;

        //            }
        //            else {
        //                alert("Error")
        //            }
        //        },
        //        error: function (e) {
        //            alert("Error with the server. Please try again.");
        //        }
        //    });

            

        //    var webMethod2 = "ProjectServices.asmx/UpdateRSVP";
        //    var parameters2 = "{\"eventId\":\"" + encodeURI(eventId) + "\",\"rsvpCount\":\"" + encodeURI(rsvpCount) + "\"}";

        //    $.ajax({
        //        async: false,
        //        type: "POST",
        //        url: webMethod2,
        //        data: parameters2,
        //        contentType: "application/json; charset=utf-8",
        //        dataType: "json",
        //        success: function (msg) {
        //            if (msg.d) {
                        
        //            }
        //            else {
        //                alert("Error")
        //            }
        //        },
        //        error: function (e) {
        //            alert("Error with the server. Please try again.");
        //        }
        //    });

        //    loadEvents();
        //    document.getElementById(eventId).disabled = true;
         
        //}

        ////LogOffFunction
        function LogOff() {

            var webMethod = "ProjectServices.asmx/LogOff";

            $.ajax({
                type: "POST",
                url: webMethod,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d) {
                        //we logged off, so go back to logon page
                        goToLogOn();

                    }
                    else {
                        alert("Error")
                    }
                },
                error: function (e) {
                    
                }
            });
        }

        //function newEvent() {
        //    var webMethod = "ProjectServices.asmx/NewEvent";
        //    var creatorId = localStorage.getItem("sessionId");
        //    var className = $('#newClassName').val();
        //    var desc = $('#newDesc').val();
        //    var date = $('#newDate').val();
        //    var time = $('#newTime').val();
        //    var location = $('#newLocation').val();
        //    var rsvpCount = 0;
        //    var parameters = "{\"className\":\"" + encodeURI(className) + "\",\"desc\":\"" + encodeURI(desc) + "\",\"date\":\"" + encodeURI(date) + "\",\"time\":\"" + encodeURI(time) + "\",\"location\":\"" + encodeURI(location) + "\",\"creatorId\":\"" + encodeURI(creatorId) + "\",\"rsvpCount\":\"" + encodeURI(rsvpCount) + "\"}";
        //    $.ajax({
        //        type: "POST",
        //        url: webMethod,
        //        data: parameters,
        //        contentType: "application/json; charset=utf-8",
        //        dataType: "json",
        //        success: function (msg) {
        //            alert("Event added.");
        //        },
        //        error: function (e) {
        //            alert("An error was encountered. Please try again.");
        //        }
        //    });
        //}

                
        //var eventsArray;
        //var usersArray;


        function loadFilteredMentors() {
            var webMethod = "ProjectServices.asmx/GetFilteredProfiles";
            var uid = localStorage.getItem("sessionId");

            if (sessionType == "mentee") {
                var jobTitleFilter = $('#menteeJobTitleFilter').val();
                var expertiseFilter = $('#menteeExpertiseFilter').val();
            }
            else if (sessionType == "mentorMentee") {
                var jobTitleFilter = $('#bothJobTitleFilter').val();
                var expertiseFilter = $('#bothExpertiseFilter').val();
            }

            var parameters = "{\"sessionId\":\"" + encodeURI(uid) + "\",\"jobTitle\":\"" + encodeURI(jobTitleFilter) + "\",\"expertise\":\"" + encodeURI(expertiseFilter) + "\"}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {

                    if (msg.d.length > 0) {

                        profilesArray = msg.d;

                        $(".mentorList").empty();

                        
                        for (var i = 0; i < profilesArray.length; i++) {

                            if (profilesArray[i].registerId != localStorage.getItem("sessionId")) {

                                var profile = "<div class='profileCard'>" +
                                    "<div class='nameBar'> <b>" + profilesArray[i].fName + " " + profilesArray[i].lName + "</b> </div> <br>" +
                                    "<b>Job:</b> " + profilesArray[i].jobTitle + "<br>" +
                                    "<b>Expertise</b>: " + profilesArray[i].expertise + "<br>" +
                                    "<div class='requestMentorBar'>" +
                                    "<div class='menteeCount'>" + "Current Mentees: " + profilesArray[i].numOfMentees + "/3</div>" +
                                    "<button type=button class='requestButton'>Request Mentor</button>" +
                                    "</div>" +
                                    "</div>" +
                                    "<hr>";


                                $(".mentorList").append(profile);

                            }
                        }
                    }
                    else {
                        $(".mentorList").empty();
                        $(".mentorList").append("No Results");
                    }
                },
                error: function (e) {
                    alert("Can't load mentors." + e);
                }
            });
        }


        function loadMentors() {
            var webMethod = "ProjectServices.asmx/GetProfiles";
            var uid = localStorage.getItem("sessionId");
            var parameters = "{\"sessionId\":\"" + encodeURI(uid) + "\"}";
                   
            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    
                    if (msg.d.length > 0) {
                                                
                        profilesArray = msg.d;
                        
                        for (var i = 0; i < profilesArray.length; i++) {

                            if (profilesArray[i].registerId != localStorage.getItem("sessionId")) {

                                var profile = "<div class='profileCard'>" +
                                        "<div class='nameBar'> <b>" + profilesArray[i].fName + " " + profilesArray[i].lName + "</b> </div> <br>" +
                                        "<b>Job:</b> " + profilesArray[i].jobTitle + "<br>" +
                                        "<b>Expertise</b>: " + profilesArray[i].expertise + "<br>" +
                                        "<div class='requestMentorBar'>"  +
                                            "<div class='menteeCount'>" + "Current Mentees: " + profilesArray[i].numOfMentees + "/3</div>" +
                                            "<button type=button class='requestButton'>Request Mentor</button>" +
                                        "</div>" +
                                    "</div>" +
                                    "<hr>";
                                
                                $(".mentorList").append(profile);
                            }
                        }

                    }
                },
                error: function (e) {
                    alert("Can't load mentors." + e);
                }
            });
        }
    </script>

</body>
</html>
